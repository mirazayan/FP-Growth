---
title: "Algoritma FP Growth dan Algoritma Apriori dengan R"
author: "Mira Zayan-Institut Teknologi Statistika dan Bisnis Muhammadiyah"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: flatly
    higlight: zenburn
    toc: true
    toc_float:
      collapsed: true
    df_print: paged
bibliography: references.bib
---

```{=html}
<style>
body{
text-align: justify}
</style>
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Algoritma FP Growth
  Algoritma Frequent Pattern Growth (FP-Growth) adalah salah satu alternatif algoritma yang dapat digunakan untuk menentukan himpunan data yang paling sering muncul (frequent itemset) dalam sebuah kumpulan data. FP-Growth dapat menemukan frekuensi itemset dengan hanya sedikit mengakses pada database aslinya, dan pendekatannya adalah yang paling efisien. (Wiyana,2018)

 Algoritma FP-Growth merupakan pengembangan dari algoritma Apriori. Algoritma FP-Growth  dapat menghindari permasalahan jika jumlah calon itemset nya terlalu besar. FP-Growth menggunakan konsep pembangunan tree dalam pencarian frequent itemset. Hal tersebut yang menyebabkan algoritma FP-Growth lebih cepat dari algoritma Apriori. Dengan menggunakan FP-Tree, algoritma FP-Growth dapat langsung mengekstrak frequent itemset dari FP-Tree. Penggalian itemset yang frequent dengan menggunakan algoritma FP-Growth akan dilakukan dengan cara membangkitkan struktur data tree. (Erwin, 2009)
 
Kesimpulan : Algoritma FP-Growth adalah perhitungan alogaritma untuk menampilkan item/data yang paling sering muncul dengan konsep tree (FP-Tree) untuk menentukan frekuensi item terbanyak.


# 2. Eksperimen Alogaritma FP Growth
## 2.1 Library

```{r warning=FALSE}
library(readr)
df1 <- read_csv("store_data.csv")
df1
```
## Memanggil Library

```{r}
library(Matrix)
library(arules)
library(arulesViz)
df2 = read.transactions("store_data.csv",sep=",",rm.duplicates=TRUE)
```
## 2.2 Memanggil Data

```{r}
table = as(df2,"transactions")
table
```

## Menampilkan data sebagai Transaksi
```{r}
read.transactions(file = "store_data.csv",
                  format = "single",
                  sep = "\t",
                  cols = c(1,2),
                  skip = 1)
```

## Menampilkan Daftar item Transaksi
```{r}
df2@itemInfo
df2@itemsetInfo
```

## 2.3 Menampilkan Kombinasi dari Contoh Transaksi


```{r}
inspect(apriori(df2, parameter = list(support = .1, minlen = 2, target = 'frequent itemsets')))
mba <- apriori(df2, parameter = list(support = .03, minlen = 2, target = 'frequent itemsets'))
inspect(head(mba))
```

# Algoritma Apriori

Algoritma apriori adalah salah satu algoritma yang merupakan penerapan praktis dari Market Basket Analysis (MBA). Algoritma ini digunakan untuk menganalisa banyaknya kombinasi produk yang terjadi di dalam transaksi ritel, yang akan sulit dan lama jika dilakukan secara manual.

Secara teknis, algoritma apriori akan mencari tingkat asosiasi antar item di dalam banyak kombinasi kelompok data secara otomatis. Kombinasi ini juga bisa disusun dengan suatu aturan (rule) asosiasi “Jika membeli ini produk A maka akan membeli produk B”, sehingga algoritma ini dikategorikan sebagai Association Rules di ranah machine learning.


# Item dan Transaksi

```{r}
transaksi_tabular <- read.csv("store_data.csv", sep = "\t")

print(transaksi_tabular)
```

## 3.3 Summary Data

```{r}
summary.default(table)
summary(table)
```

## Item Frequency
```{r}
itemFrequency(df2)
itemFrequency(df2, type = "absolute")

```
## Statistik Top 3

```{r}
data_item <- itemFrequency(df2, type = "absolute")

#Melakukan sorting pada data_item
data_item <- sort(data_item, decreasing = T)

#Mengambil 3 item pertama, atau bisa dengan data_item[1:3]
head(data_item, 3)
```

```{r}
#Konversi data_item menjadi data frame dengan kolom Nama_Produk dan Jumlah.
data_item <- data.frame("Nama Produk" = names(data_item),
                        "Jumlah" = data_item,
                        row.names = NULL)

print(data_item)
```

## Grafik Item Frekuensi
```{r}
itemFrequencyPlot(table,topN = 15, main="Item Frequency")

```


# Itemset dan Rules

Tiap transaksi terdiri atas beberapa item atau itemset. Pada praktek sebelumnya, kita baru melihat visualisasi dan sebaran matrix dari tiap transaksi namun masih sulit dicerna.


## Menghasilkan Rules dengan Apriori

```{r}
apriori(df2)
```
## Melihat Rules dengan Fungsi Inspect

```{r}
inspect(mba)
```

## Filter RHS

```{r}
mba <- apriori(df2, parameter = list(supp = 0.1, confidence = 0.5))
inspect(subset(mba, rhs %in% "mineral water"))
```
```{r}
inspect(subset(mba, rhs %in% "eggs"))
```


```{r}
# Menghasilkan model Market Basket Analysis
mba <- apriori(df2, parameter = list(supp = 0.1, confidence = 0.5))

# Menampilkan jumlah kombinasi dari produk yang terdapat pada daftar transaksi yang ada
inspect(apriori(df2, parameter = list(support = .1, minlen = 2, target = 'frequent itemsets')))
```


```{r}
data_item <- itemFrequency(df2, type = "absolute")

#Melakukan sorting pada data_item
data_item <- sort(data_item, decreasing = T)

#Mengambil 3 item pertama, atau bisa dengan data_item[1:3]
head(data_item, 3)
```


```{r}
#Konversi data_item menjadi data frame dengan kolom Nama_Produk dan Jumlah.
data_item <- data.frame("Nama Produk" = names(data_item),
                        "Jumlah" = data_item,
                        row.names = NULL)

print(data_item)
```
```{r eval=FALSE}
mba <- apriori(df2, parameter = list(supp = 0.1, confidence = 0.5))
# Filter rhs dengan item "mineral water" dan tampilkan

inspect(subset(mba, rhs %in% "mineral water"))
inspect(subset(mba, (lhs %in% "mineral water" | rhs %in% "mineral water") & lift > 1))
```


## 3.3 Filter LHS
```{r}
mba <- apriori(df2)
inspect(subset(mba, lhs %in% "eggs"))
inspect(apriori(df2, parameter = list(supp = 0.1, confidence = 0.5)))
```
```{r}
rules<-apriori(data=df2, parameter=list(supp=0.001,conf = 0.15,minlen=2), 
               appearance = list(default="rhs",lhs="mineral water"),
               control = list(verbose=F))
rules<-sort(rules, decreasing=TRUE,by="confidence")
inspect(rules[1:5])
```




```{r}
mba <- apriori(df2, parameter = list(supp = 0.1, confidence = 0.5))
apriori(df2, parameter = list(supp = 0.1, confidence = 0.5))
inspect(apriori(df2, parameter = list(supp = 0.1, confidence = 0.5)))
```
## 3.5 Visualisasi Graph


```{r}
df2 <- read.transactions(file = "store_data.csv",
                               format = "single", 
                               sep = "\t",
                               cols = c(1,2),
                               skip = 1)

mba <- apriori(df2, parameter = list(supp = 0.1, confidence = 0.5))

```


```{r}
image(df2[1:20], method="graph")
plot(df2, (mba, lift > 1.1), method = "graph"))
```


# Referensi
1. https://rpubs.com/metro_dolan/mba_in_r


2. https://rpubs.com/sitiramadeskaa/904549


3.Dataset : https://github.com/ashishpatel26/Market-Basket-Analysis/blob/master/Data/store_data.csv

4. https://github.com/mirazayan


5. https://rpubs.com/mirazayan
